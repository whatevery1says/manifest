# Schema Validation Files

This folder contains a collection of documents for validating manifests against the WhatEvery1Says manifest schema. The documents are all generated using the [Python `JSL` library](http://jsl.readthedocs.io/en/latest/index.html). If the manifests need to be modified, the Python files should be used and the JSON re-generated in order to ensure consistency.

In Python applications, data can be validated against the JSON schema files using the [`jsonschema` validation library](http://python-jsonschema.readthedocs.io/en/latest/#).

## Installation

To install JSL:

```python
pip install jsl
```

To install jsonschema:

```python
pip install jsonschema
```

## Generating a Manifest

The JSL Python code will output a manifest in string format. There is no built-in code to write the string to a file, but it is easy to copy and paste in a file and then saved in JSON format. The manifest string itself is generated by a helper function that performs some cleanup on the JSL output. This is necessary because of occasional peculiarities. Here are some known issues with JSL output:

1. Property keywords are prefixed with `__main__.`.
1. JSL does not have a `date` format (only `datetime`). As a workaround, the schema is given a placeholder, and the helper function converts the placeholder to valid JSON schema.
1. JSL generates boolean values in lower case, which is valid JSON but does not appear to be parsed correctly in by the `jsonschema` library. As a workaround, the helper function capitalises them.
1. By default, the `additional_properties` keyword is set the `False`, and I have not yet figured out how to modify this. If there are custom metadata properties, this value should manually be set to `True` in the generated manifest.

## Validating Data against a Manifest

A typical method of validating data might look like this:

```python
import json
from jsonschema import validate

# Read the manifest file
with open('Publications.json') as manifest_file:
    schema = json.load(manifest_file)

# Sample manifest to be validated
data = {
  "_id": "New_York_Times",
  "publication": "The New York Times",
  "path": ",Publications,",
  "description": "All the news thatâ€™s fit to download",
  "publisher": "The New York Times",
  "date": [{"start": "2013-01-01"}, {"end": "2013-01-01"}],
   "edition": "online",
   "altTitle": "New York Times",
   "contentType": "newspaper",
   "language": "en",
   "country": "USA",
   "authors": ["John Smith"]
}

# Validate the manifest
validate(data, schema)
```

If no exception is raised by `validate()`, the instance is valid.

**Note:** `jsonschema` validation errors are often less informative than one would like. But at least you know that there is the data is invalid. If it is not clear what is wrong, it is worth checking whether the manifest is well-formed JSON using [jsonlint](https://jsonlint.com/). If this does not reveal the problem, then the manifest does not follow the WE1S manifest schema in some way.